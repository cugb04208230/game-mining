@model WebApp.Models.WithdrawViewModel
@{
    ViewBag.Title = "我要提分";
}

@section css
{
    <style type="text/css">
        .title {
            font-size: 14px;
        }
    </style>
}


<div class="main" style="margin-top: 50px; margin-bottom: 96px;">
    <div class="content">
        <div class="container">
            @Html.ValidationSummary(true)
            <form method="post" action="/Member/Withdraw">
                @Html.AntiForgeryToken()
                <div align="center">
                    <table class="formTable">
                        <tbody>
                            <tr>
                                <td>
                                    <label> 开户银行及支行名称:</label>
                                    @Html.TextBoxFor(model => model.BankName, new { @placeholder = "请补充分行名称" })
                                    @Html.ValidationMessageFor(model => model.BankName)
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label> 银行卡号:</label>
                                    @Html.TextBoxFor(model => model.CardId, new { @placeholder = "请补充银行卡号ID" })
                                    @Html.ValidationMessageFor(model => model.CardId)

                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <label> 用户姓名:</label>
                                    @if (string.IsNullOrEmpty(Model.UserName))
                                    {
                                        @Html.TextBoxFor(model => model.UserName, new { @placeholder = "请补充用户姓名" })
                                    }
                                    else
                                    {
                                        @Html.TextBoxFor(model => model.UserName, new { @placeholder = "请补充用户姓名", Readonly = "true" })
                                    }
                                    @Html.ValidationMessageFor(model => model.UserName)
                                </td>
                            </tr>

                            <tr>
                                <td>
                                    <label> 提分额:</label>
                                    @Html.TextBoxFor(model => model.Amount, new { @placeholder = "输入提现金额（100分起）" })
                                    @Html.ValidationMessageFor(model => model.Amount)
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label> 手机号:</label>
                                    @Html.TextBoxFor(model => model.Mobile, new { @placeholder = "",Readonly="true" })
                                    @Html.ValidationMessageFor(model => model.Mobile)
                                </td>
                            </tr>
                            <tr>
                                <td>

                                    @Html.TextBoxFor(model => model.VerifyCode, new { placeholder = "验证码", style = "min-width:50%; float:left;" })
                                    <span id="imgid" style="color: #C10; float: left; margin:0px 0 0 5px;">
                                        <input class="buttonWrap button button-blue buttonLong" type="button" id="btnGetVerifyCode"
                                               value="获取验证码" />
                                    </span>
                                    @Html.ValidationMessageFor(model => model.VerifyCode)
                                </td>
                            </tr>

                            <tr>
                                <td style="color:red">
                                    友情提醒：每周二开放申请提分（农业银行免收手续费，其他银行收取1%手续费）
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="submit" class="buttonWrap button button-green buttonLong" value="立刻提分">
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>
</div>


@section scripts
{
    <script type="text/javascript">
        function checkMobile(value) {
            if (!(/^1[3|4|5|7|8]\d{9}$/.test(value))) {
                return false;
            }
            return true;
        }
        var wait = 60;
        function time(o) {
            if (wait == 0) {
                o.removeAttribute("disabled");
                o.value = "获取验证码";
                wait = 60;
            } else {
                o.setAttribute("disabled", true);
                o.value = "重新发送(" + wait + ")";
                wait--;
                setTimeout(function () {
                    time(o)
                }, 1000);
            }
        }
        $(function () {
            $('#btnGetVerifyCode').on('click', function () {
                var userId = $('#Mobile').val();
                if (userId == '') {
                    alert("请输入手机号码！");
                    return;
                }
                var isPhone = checkMobile(userId);
                if (isPhone) {
                    var url = "/Member/SendWithdrawVerifyCode?destmobile=" + userId;
                    $.get(url,
                        function (response) {
                            var statusCode = response["StatusCode"];
                            if (statusCode == 0)
                                alert("短信验证码发送成功！");
                            else
                                alert("短信验证码发送失败！");

                        });
                }
                else {

                    alert("手机号码格式错误！");
                    return;
                }

                time(this);
            });
        });
    </script>
}
