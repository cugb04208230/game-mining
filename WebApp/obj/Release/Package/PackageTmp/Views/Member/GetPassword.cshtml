@model WebApp.Models.GetPasswordViewModel
@{
    Layout = null;
    ViewBag.Title = "找回密码";
}

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>@ViewBag.Title</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/Resource/css/style.css" rel="stylesheet" type="text/css">
    <link href="~/Content/Resource/css/color.css" rel="stylesheet" type="text/css">
    <link href="~/Content/Resource/css/framework.css" rel="stylesheet" type="text/css">
    <link href="~/Content/Resource/css/yellowtips.css" rel="stylesheet" type="text/css">
    <link href="~/Content/Resource/css/font-awesome.css" rel="stylesheet" type="text/css">
    <link href="~/Content/Resource/css/mycss.css" rel="stylesheet" type="text/css">

    <link href="~/Content/Site.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.validate.min.js"></script>
    <style type="text/css">
        .verifycode {
            min-width: 50%;
            float: left;
        }
    </style>
</head>
<body style="">

    <div class="wrapBox">
        <header>
            <div class="headBox">
                <h2>@ViewBag.Title</h2>
                <a class="aBlock aBack" href="javascript:history.back()"><i class="fa fa-chevron-left"></i></a>
                <!--
                <a class="aBlock aHome" href="#"><i class="fa fa-home"></i></a>
                -->
            </div>
        </header>


        <div class="main" style="margin-top: 50px;margin-bottom: 96px;">
            <div class="content">
                <div class="container">
                    @Html.ValidationSummary(true)
                    <form action="/Member/GetPassword" method="post">
                        @Html.AntiForgeryToken()
                        <div align="center">
                            <table class="formTable">
                                <tbody>
                                    <tr>
                                        <td>
                                            <label> 登录名:</label>
                                            @Html.TextBoxFor(model => model.UserId, new { @placeholder = "请输入注册时的登录名" })
                                            @Html.ValidationMessageFor(model => model.UserId)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label> 手机号:</label>
                                            @Html.TextBoxFor(model => model.Mobile, new { @placeholder = "请输入注册时的手机号" })
                                            @Html.ValidationMessageFor(model => model.Mobile)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label> 新密码:</label>
                                            @Html.PasswordFor(model => model.Password, new { @placeholder = "登录新密码" })
                                            @Html.ValidationMessageFor(model => model.Password)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label> 确认新密码:</label>
                                            @Html.PasswordFor(model => model.ConfirmPassword, new { @placeholder = "确认新密码" })
                                            @Html.ValidationMessageFor(model => model.ConfirmPassword)
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label> 验证码:</label>
                                            @Html.TextBoxFor(model => model.VerifyCode, new { @placeholder = "验证码", @style = "min-width:50%; float:left;" })
                                            <span id="imgid" style="color: #C10; float: left; margin:0px 0 0 5px;">
                                                <input class="buttonWrap button button-blue buttonLong" type="button" id="btnGetVerifyCode"
                                                       value="获取验证码" />
                                            </span>
                                            @Html.ValidationMessageFor(model => model.VerifyCode)
                                        </td>
                                    </tr>

                                    <tr>
                                        <td>

                                            <input type="submit" class="buttonWrap button button-green buttonLong" value="重置密码">
                                        </td>
                                    </tr>


                                </tbody>
                            </table>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            function checkMobile(value) {
                if (!(/^1[3|4|5|7|8]\d{9}$/.test(value))) {
                    return false;
                }
                return true;
            }
            var wait = 60;
            function time(o) {
                if (wait == 0) {
                    o.removeAttribute("disabled");
                    o.value = "获取验证码";
                    wait = 60;
                } else {
                    o.setAttribute("disabled", true);
                    o.value = "重新发送(" + wait + ")";
                    wait--;
                    setTimeout(function () {
                        time(o)
                    }, 1000);
                }
            }
            $(function () {
                $('#btnGetVerifyCode').on('click', function () {
                    var userId = $('#Mobile').val();
                    if (userId == '') {
                        alert("请输入手机号码！");
                        return;
                    }
                    var isPhone = checkMobile(userId);
                    if (isPhone) {
                        var url = "/member/SendGetPasswordVerifyCode?destmobile=" + userId;
                        $.get(url,
                            function (response) {
                                var statusCode = response["StatusCode"];
                                if (statusCode == 0)
                                    alert("短信验证码发送成功！");
                                else
                                    alert("短信验证码发送失败！");

                            });
                    }
                    else {

                        alert("手机号码格式错误！");
                        return;
                    }

                    time(this);
                });
            });
        </script>


    </div>

</body>
</html>